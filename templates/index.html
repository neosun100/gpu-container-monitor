<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Container Monitor ¬∑ Enterprise Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container { 
            width: 100%;
            max-width: 100%;
            margin: 0 auto; 
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideDown 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
            animation: float 3s ease-in-out infinite;
        }
        
        .header h1 {
            font-size: 3.5em;
            font-weight: 800;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            line-height: 1.2;
        }
        
        .header .subtitle {
            font-size: 1.1em;
            color: rgba(255,255,255,0.6);
            font-weight: 400;
            margin-top: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .github-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .github-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .github-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255,255,255,0.2);
        }
        
        .github-btn.star {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            border-color: transparent;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
        }
        
        .github-btn.star:hover {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            box-shadow: 0 6px 30px rgba(245, 158, 11, 0.6);
        }
        
        .controls-panel {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .refresh-btn:active {
            transform: translateY(0);
        }
        
        .interval-group {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(255,255,255,0.05);
            padding: 6px;
            border-radius: 12px;
        }
        
        .interval-label {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            font-weight: 500;
            margin-right: 8px;
            padding-left: 8px;
        }
        
        .interval-btn {
            background: transparent;
            color: rgba(255,255,255,0.7);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .interval-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .interval-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
        }
        
        .gpu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .gpu-card {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.6s ease-out backwards;
        }
        
        .gpu-card:hover {
            transform: translateY(-8px);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }
        
        .gpu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .gpu-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .gpu-index {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 18px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .gpu-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .stat-label {
            font-size: 0.85em;
            color: rgba(255,255,255,0.6);
            margin-bottom: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #fff;
        }
        
        .metric-bar {
            margin-bottom: 20px;
        }
        
        .metric-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: rgba(255,255,255,0.7);
            font-weight: 500;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .progress-gpu { background: linear-gradient(90deg, #10b981, #34d399); }
        .progress-memory { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
        .progress-power { transition: background 0.6s; }
        
        .container-section {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 35px;
            animation: fadeIn 0.8s ease-out;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .section-title {
            font-size: 2em;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .sort-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .sort-btn {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .sort-btn:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .sort-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }
        
        .container-group {
            margin-bottom: 35px;
        }
        
        .group-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border-left: 4px solid;
        }
        
        .group-header.healthy { border-left-color: #10b981; }
        .group-header.running { border-left-color: #22c55e; }
        .group-header.paused { border-left-color: #f59e0b; }
        .group-header.stopped { border-left-color: #ef4444; }
        .group-header.other { border-left-color: #6b7280; }
        
        .group-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #fff;
        }
        
        .group-count {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .stats-badges {
            display: flex;
            gap: 15px;
        }
        
        .stat-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95em;
            box-shadow: 0 4px 20px rgba(245, 87, 108, 0.3);
        }
        
        .status-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: rgba(255,255,255,0.8);
        }
        
        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }
        
        thead tr {
            background: rgba(255,255,255,0.05);
        }
        
        th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
        }
        
        th:first-child { border-radius: 12px 0 0 12px; }
        th:last-child { border-radius: 0 12px 12px 0; }
        
        tbody tr {
            background: rgba(255,255,255,0.03);
            transition: all 0.3s;
        }
        
        tbody tr:hover {
            background: rgba(255,255,255,0.08);
            transform: scale(1.01);
        }
        
        td {
            padding: 20px;
            border: none;
            color: rgba(255,255,255,0.9);
        }
        
        tbody tr td:first-child { border-radius: 12px 0 0 12px; }
        tbody tr td:last-child { border-radius: 0 12px 12px 0; }
        
        .memory {
            font-weight: 700;
            color: #60a5fa;
            font-size: 1.1em;
        }
        
        .gpu-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 3px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .status {
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-healthy { background: linear-gradient(135deg, #10b981, #34d399); color: white; }
        .status-running { background: linear-gradient(135deg, #22c55e, #4ade80); color: white; }
        .status-paused { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; }
        .status-restarting { background: linear-gradient(135deg, #eab308, #facc15); color: #000; }
        .status-exited { background: linear-gradient(135deg, #ef4444, #f87171); color: white; }
        .status-created { background: linear-gradient(135deg, #6b7280, #9ca3af); color: white; }
        .status-removing { background: linear-gradient(135deg, #dc2626, #ef4444); color: white; }
        .status-dead { background: linear-gradient(135deg, #991b1b, #dc2626); color: white; }
        
        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s;
            color: white;
        }
        
        .btn-pause { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .btn-unpause { background: linear-gradient(135deg, #10b981, #34d399); }
        .btn-restart { background: linear-gradient(135deg, #3b82f6, #60a5fa); }
        .btn-stop { background: linear-gradient(135deg, #ef4444, #f87171); }
        .btn-start { background: linear-gradient(135deg, #10b981, #34d399); }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.6);
            font-size: 1.1em;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .gpu-card:nth-child(1) { animation-delay: 0.1s; }
        .gpu-card:nth-child(2) { animation-delay: 0.2s; }
        .gpu-card:nth-child(3) { animation-delay: 0.3s; }
        .gpu-card:nth-child(4) { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo-icon">‚ö°</div>
                <h1>GPU MONITOR</h1>
            </div>
            <p class="subtitle">Enterprise Container Intelligence Platform</p>
            <div class="github-links">
                <a href="https://github.com/neosun100/gpu-container-monitor" target="_blank" class="github-btn star">
                    <span>‚≠ê</span>
                    <span>Star on GitHub</span>
                </a>
                <a href="https://github.com/neosun100/gpu-container-monitor/issues/new" target="_blank" class="github-btn">
                    <span>üêõ</span>
                    <span>Report Bug</span>
                </a>
                <a href="https://github.com/neosun100/gpu-container-monitor/issues/new?labels=enhancement" target="_blank" class="github-btn">
                    <span>üí°</span>
                    <span>Request Feature</span>
                </a>
            </div>
        </div>
        
        <div class="controls-panel">
            <div class="control-group">
                <button class="refresh-btn" onclick="loadData()">
                    <span>üîÑ</span>
                    <span>Refresh Now</span>
                </button>
            </div>
            <div class="control-group">
                <div class="interval-group">
                    <span class="interval-label">Auto Refresh</span>
                    <button class="interval-btn" onclick="updateInterval(1000)" data-interval="1000">1s</button>
                    <button class="interval-btn active" onclick="updateInterval(3000)" data-interval="3000">3s</button>
                    <button class="interval-btn" onclick="updateInterval(5000)" data-interval="5000">5s</button>
                    <button class="interval-btn" onclick="updateInterval(10000)" data-interval="10000">10s</button>
                </div>
            </div>
        </div>

        <div class="gpu-grid" id="gpuGrid"></div>

        <div class="container-section">
            <div class="section-header">
                <div class="section-title">
                    <span>üì¶</span>
                    <span>Container Fleet</span>
                </div>
                <div class="sort-controls">
                    <span class="sort-label">Sort by:</span>
                    <button class="sort-btn" onclick="setSortBy('name')" id="sort-name">Name</button>
                    <button class="sort-btn active" onclick="setSortBy('memory')" id="sort-memory">VRAM ‚Üì</button>
                    <button class="sort-btn" onclick="setSortBy('gpu')" id="sort-gpu">GPU ID</button>
                </div>
                <div class="stats-badges">
                    <div class="stat-badge">Containers: <span id="containerCount">0</span></div>
                    <div class="stat-badge">Total VRAM: <span id="totalMemory">0</span> MiB</div>
                </div>
            </div>
            
            <div id="containerGroups"></div>
        </div>
    </div>

    <script>
        let refreshTimer = null;
        let currentRefreshInterval = 3000;
        let currentSortBy = 'memory';

        function updateInterval(interval) {
            currentRefreshInterval = interval;
            
            document.querySelectorAll('.interval-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.getAttribute('data-interval')) === interval) {
                    btn.classList.add('active');
                }
            });
            
            if (refreshTimer) {
                clearInterval(refreshTimer);
            }
            
            refreshTimer = setInterval(() => loadData(), interval);
            console.log('Refresh interval updated to:', interval + 'ms');
        }
        
        function setSortBy(sortBy) {
            currentSortBy = sortBy;
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('sort-' + sortBy).classList.add('active');
            loadData();
        }
        
        function sortContainers(containers) {
            return containers.sort((a, b) => {
                if (currentSortBy === 'memory') {
                    return b.memory - a.memory;
                } else if (currentSortBy === 'name') {
                    return a.name.localeCompare(b.name);
                } else if (currentSortBy === 'gpu') {
                    return (a.gpus[0] || 0) - (b.gpus[0] || 0);
                }
                return 0;
            });
        }
        
        function getStatusGroup(status) {
            const s = status.toLowerCase();
            if (s.includes('healthy')) return { key: 'healthy', name: '‚úì Healthy', icon: '‚úì' };
            if (s.includes('up') && !s.includes('paused')) return { key: 'running', name: '‚ñ∂ Running', icon: '‚ñ∂' };
            if (s.includes('paused')) return { key: 'paused', name: '‚è∏ Paused', icon: '‚è∏' };
            if (s.includes('exited') || s.includes('stopped')) return { key: 'stopped', name: '‚èπ Stopped', icon: '‚èπ' };
            return { key: 'other', name: '‚óã Other', icon: '‚óã' };
        }

        function renderGPUs(gpus) {
            const grid = document.getElementById('gpuGrid');
            
            gpus.forEach((gpu, idx) => {
                let card = document.getElementById(`gpu-card-${gpu.index}`);
                
                if (!card) {
                    card = document.createElement('div');
                    card.className = 'gpu-card';
                    card.id = `gpu-card-${gpu.index}`;
                    card.style.animationDelay = (idx * 0.1) + 's';
                    card.innerHTML = `
                        <div class="gpu-header">
                            <div class="gpu-name">
                                <span>üéÆ</span>
                                <span>${gpu.name}</span>
                            </div>
                            <div class="gpu-index">GPU ${gpu.index}</div>
                        </div>
                        <div class="gpu-stats">
                            <div class="stat-item">
                                <div class="stat-label">üå°Ô∏è Temperature</div>
                                <div class="stat-value" id="temp-${gpu.index}">--¬∞C</div>
                            </div>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-label">
                                <span>‚ö° Power Draw</span>
                                <span id="power-text-${gpu.index}">-- / -- W</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-power" id="power-bar-${gpu.index}" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-label">
                                <span>üíª GPU Utilization</span>
                                <span id="util-text-${gpu.index}">--%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-gpu" id="util-bar-${gpu.index}" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-label">
                                <span>üíæ VRAM Usage</span>
                                <span id="mem-text-${gpu.index}">-- / -- MiB</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-memory" id="mem-bar-${gpu.index}" style="width: 0%"></div>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                }
                
                const memPercent = (gpu.memory_used / gpu.memory_total * 100).toFixed(1);
                const powerPercent = (gpu.power_draw / gpu.power_limit * 100).toFixed(1);
                
                // Dynamic temperature color
                let tempColor = '#10b981';
                if (gpu.temperature >= 85) tempColor = '#dc2626';
                else if (gpu.temperature >= 80) tempColor = '#ef4444';
                else if (gpu.temperature >= 75) tempColor = '#f97316';
                else if (gpu.temperature >= 70) tempColor = '#f59e0b';
                else if (gpu.temperature >= 60) tempColor = '#eab308';
                
                // Dynamic power color
                let powerColor = '#10b981';
                if (powerPercent >= 90) powerColor = '#dc2626';
                else if (powerPercent >= 85) powerColor = '#ef4444';
                else if (powerPercent >= 75) powerColor = '#f97316';
                else if (powerPercent >= 65) powerColor = '#f59e0b';
                else if (powerPercent >= 50) powerColor = '#eab308';
                
                document.getElementById(`temp-${gpu.index}`).innerHTML = `${gpu.temperature}¬∞C`;
                document.getElementById(`temp-${gpu.index}`).style.color = tempColor;
                
                document.getElementById(`power-text-${gpu.index}`).textContent = `${gpu.power_draw.toFixed(1)} / ${gpu.power_limit.toFixed(0)} W`;
                document.getElementById(`power-text-${gpu.index}`).style.color = powerColor;
                document.getElementById(`power-bar-${gpu.index}`).style.width = `${powerPercent}%`;
                document.getElementById(`power-bar-${gpu.index}`).style.background = `linear-gradient(90deg, ${powerColor}, ${powerColor}dd)`;
                
                document.getElementById(`util-text-${gpu.index}`).textContent = `${gpu.utilization}%`;
                document.getElementById(`util-bar-${gpu.index}`).style.width = `${gpu.utilization}%`;
                document.getElementById(`mem-text-${gpu.index}`).textContent = `${gpu.memory_used} / ${gpu.memory_total} MiB`;
                document.getElementById(`mem-bar-${gpu.index}`).style.width = `${memPercent}%`;
            });
        }

        function getStatusInfo(status) {
            const s = status.toLowerCase();
            if (s.includes('healthy')) return { class: 'status-healthy', icon: '‚úì', text: 'Healthy' };
            if (s.includes('up') && !s.includes('paused')) return { class: 'status-running', icon: '‚ñ∂', text: 'Running' };
            if (s.includes('paused')) return { class: 'status-paused', icon: '‚è∏', text: 'Paused' };
            if (s.includes('restarting')) return { class: 'status-restarting', icon: 'üîÑ', text: 'Restarting' };
            if (s.includes('exited')) return { class: 'status-exited', icon: '‚èπ', text: 'Stopped' };
            if (s.includes('created')) return { class: 'status-created', icon: '‚óã', text: 'Created' };
            if (s.includes('removing')) return { class: 'status-removing', icon: 'üóë', text: 'Removing' };
            if (s.includes('dead')) return { class: 'status-dead', icon: '‚úó', text: 'Dead' };
            return { class: 'status-created', icon: '?', text: status };
        }
        
        function performAction(containerId, action) {
            const actionText = {
                'stop': 'stop', 'pause': 'pause', 'unpause': 'unpause', 
                'restart': 'restart', 'start': 'start'
            };
            
            if (!confirm(`Confirm to ${actionText[action]} this container?`)) return;
            
            fetch(`/api/container/${action}/${containerId}`, { method: 'POST' })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        loadData();
                    } else {
                        alert('Operation failed: ' + data.error);
                    }
                })
                .catch(err => alert('Operation failed: ' + err));
        }
        
        function loadData() {
            fetch('/api/status')
                .then(res => res.json())
                .then(data => {
                    renderGPUs(data.gpus);
                    
                    const groupsContainer = document.getElementById('containerGroups');
                    let totalMem = 0;
                    
                    if (data.containers.length === 0) {
                        groupsContainer.innerHTML = '<div class="loading">No GPU containers found</div>';
                        document.getElementById('containerCount').textContent = '0';
                        document.getElementById('totalMemory').textContent = '0';
                        return;
                    }
                    
                    // Group containers by status
                    const groups = {};
                    data.containers.forEach(item => {
                        const group = getStatusGroup(item.status);
                        if (!groups[group.key]) {
                            groups[group.key] = { info: group, containers: [] };
                        }
                        groups[group.key].containers.push(item);
                        totalMem += item.memory;
                    });
                    
                    // Sort containers within each group
                    Object.values(groups).forEach(group => {
                        group.containers = sortContainers(group.containers);
                    });
                    
                    // Render groups in order
                    const groupOrder = ['healthy', 'running', 'paused', 'stopped', 'other'];
                    groupsContainer.innerHTML = '';
                    
                    groupOrder.forEach(key => {
                        if (!groups[key]) return;
                        
                        const group = groups[key];
                        const groupDiv = document.createElement('div');
                        groupDiv.className = 'container-group';
                        
                        groupDiv.innerHTML = `
                            <div class="group-header ${key}">
                                <div class="group-title">${group.info.name}</div>
                                <div class="group-count">${group.containers.length}</div>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Container Name</th>
                                        <th>Container ID</th>
                                        <th>GPU Devices</th>
                                        <th>Status</th>
                                        <th>VRAM Usage</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="group-${key}"></tbody>
                            </table>
                        `;
                        
                        groupsContainer.appendChild(groupDiv);
                        
                        const tbody = document.getElementById(`group-${key}`);
                        group.containers.forEach(item => {
                            const row = tbody.insertRow();
                            row.insertCell(0).innerHTML = `<strong>${item.name}</strong><br><small style="color:rgba(255,255,255,0.5)">${item.image}</small>`;
                            row.insertCell(1).innerHTML = `<code style="color:rgba(255,255,255,0.6);font-size:0.9em">${item.id}</code>`;
                            
                            const gpuCell = row.insertCell(2);
                            gpuCell.innerHTML = item.gpus.map(g => `<span class="gpu-badge">GPU ${g}</span>`).join('');
                            
                            const statusInfo = getStatusInfo(item.status);
                            row.insertCell(3).innerHTML = `<span class="status ${statusInfo.class}"><span>${statusInfo.icon}</span>${statusInfo.text}</span>`;
                            
                            row.insertCell(4).innerHTML = `<span class="memory">${item.memory.toLocaleString()} MiB</span>`;
                            
                            const actionsCell = row.insertCell(5);
                            const actions = document.createElement('div');
                            actions.className = 'actions';
                            
                            if (item.status.includes('Up') && !item.status.includes('Paused')) {
                                actions.innerHTML = `
                                    <button class="action-btn btn-pause" onclick="performAction('${item.full_id}', 'pause')">‚è∏ Pause</button>
                                    <button class="action-btn btn-restart" onclick="performAction('${item.full_id}', 'restart')">üîÑ Restart</button>
                                    <button class="action-btn btn-stop" onclick="performAction('${item.full_id}', 'stop')">‚èπ Stop</button>
                                `;
                            } else if (item.status.includes('Paused')) {
                                actions.innerHTML = `
                                    <button class="action-btn btn-unpause" onclick="performAction('${item.full_id}', 'unpause')">‚ñ∂ Resume</button>
                                    <button class="action-btn btn-stop" onclick="performAction('${item.full_id}', 'stop')">‚èπ Stop</button>
                                `;
                            } else {
                                actions.innerHTML = `<button class="action-btn btn-start" onclick="performAction('${item.full_id}', 'start')">‚ñ∂ Start</button>`;
                            }
                            
                            actionsCell.appendChild(actions);
                        });
                    });
                    
                    document.getElementById('containerCount').textContent = data.containers.length;
                    document.getElementById('totalMemory').textContent = totalMem.toLocaleString();
                })
                .catch(err => console.error('Failed to load data:', err));
        }
        
        loadData();
        refreshTimer = setInterval(() => loadData(), currentRefreshInterval);
    </script>
</body>
</html>
